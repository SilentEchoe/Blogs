---
title: ebfp 入门
date: 2024-12-12 11:04:00
tags: [ebfp]
category: ebfp
---

### eBFP是什么？

eBPF 这个概念源于 Berkeley Packet Filter(BPF) 它是一种网络过滤器，可以捕获和过滤网络数据包。

充分利用eBPF至少需要Linux4.4以上版本。

eBPF是一种Linux的内核技术，它可以用于多种场景，比较常见的用途是做网络监控，安全过滤，性能分析等。



### 如何工作？

eBPF主要分为三个步骤：加载，编译和执行。

1.eBPF 需要在内核中运行。一般由用户态的应用程序完成，它会通过系统调用来加载 eBPF程序。在加载过程中，内核会将eBPF程序的代码复制到内核空间。

2.eBPF 需要经过编译，通常情况下是由Clang/LLVM 编译器完成，形成字节码后将用户态的字节码装载进内核，Verifier 会对要注入内核的程序进行一些内核安全机制的检查，这点非常重要，这保证了eBPF程序不会破坏Linux内核的稳定性和安全性。在检查过程中，内核会对 eBPF程序的代码进行分析，比如一些敏感操作是会被禁止的，比如系统调用，内存访问等。

3.当通过内核安全机制检查后，它就可以在内核中正常运行了，通过一个JIT编译步骤将程序的通用字节码转换为机器特定指令集，以优化程序的执行速度。









