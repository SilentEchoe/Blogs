---
title: 如何设计一个好的微服务
date: 2024-9-18 10:21:00
tags: [微服务]
category: 微服务
---

### 什么是微服务？

微服务指的是一种应用架构，一系列独立的服务通过轻量级API来进行通信。

单体应用中随着功能的增加，版本的迭代，代码库会越变越大。尽管工程师努力地想要模块化每个功能模块，以达成优雅的工程化，事实上模块之间的界限变得模糊不清，代码的维护和Bug的修复会变得相当复杂。

微服务将一个巨大的单体应用拆分成若干个较小的服务，它们之间通过某种通信协议交互，最终组成整个系统服务。

比较理想的情况下，微服务通过分布式部署，这意味着开发人员可以并行开发多个微服务，进而压缩开发所需时间。对比传统的单体应用，微服务的应用要更加模块化且小巧，随着用户的激增和新功能的迭代，某一部分服务可以不断扩展，通过 Kubernetes 和云计算可以非常自由做扩缩容。

但微服务不是“银弹”，按照设计者的想法是想利用微服务灵活性和可扩展来构建出高可用高容错的系统服务。单一编程语言的单体应用很难推倒后以另一种编程语言来重写，这对产品的稳定性几乎是毁灭性打击，但微服务不同，它足够小，开发者可以短时间使用另一种编程语言重写它。

一个微服务构成的服务可能包含多种编程语言编写的服务，Go JAVA C# Python Node 等，当一个服务不在局限于某一种语言，设计者理所应当用不同编程语言的天然特性来面对复杂的现实场景，比如利用Go语言的轻便型，在网络编程方面它足够轻量和易用；使用 JAVA 可以应付大部分业务需求场景，它的泛用性足够广；在人工智能领域 Python 社区提供大量易用和前沿的代码库；

微服务可以让工程师更快引入一些新技术，并享受这些新技术带来的好处，相比单体应用，微服务总会在边缘中尝试一些新技术来验证它是否适合，即使出现风险也可控。

微服务会面对所有分布式系统需要面对的复杂性，为了得到微服务的好处，工程师往往需要在部署，测试和监控等基础设施上做大量工作，同时还需要考虑如何扩展系统，保证每个服务等弹性，多个相同服务部署后可能出现的不一致性。



### 什么是一个好的微服务？

构建一个微服务的前提是：要知道什么样的服务是好的，什么样的服务是不好的，不好的服务会给整个系统来带什么样的影响。

松耦合和高内聚在微服务中是两个重要的概念，松耦合代表着微服务的独立修改，这点非常重要，如果修改一个服务需要修改另外一个服务则代表丧失松耦合；如果工程师需要更改某个业务逻辑或行为时需要在多个不同地方做修改，则代表着丧失高内聚。

目前最常见的集成形式是数据库集成，你可以看到很多大型应用中他们将服务拆分成若干个微服务，但这些服务都会访问同一个数据库，如果一个服务想从另外一个服务获取信息，可以直接访问数据库获取信息，如果想要修改某张表的数据，也会直接在数据库中修改。这种方式看来非常简单，但往往也是被错误理解和滥用导致的典型例子。

对于微服务来说，数据库是一个很大的共享API，只要能完全访问该数据库，那么微服务中的所有服务都是平等的，代表的是非常不稳定性。当业务发生变化，工程师想要改变相对应的逻辑，为了更好表示数据和可维护性修改表结构时，波及面不可避免的扩大。为了不影响其他服务，工程师必须小心避免修改与其他服务相关的表结构，从个人的经验上来看，某些情况是避无可避的，这种情况下压力就转移到了测试工程师的身上，需要做大量回归测试来保证功能的正确性。

使用微服务是为了让服务拥有一定的容错性，当修复一个Bug时需要修改多个不同的地方，并且要对这些修改分别编译并重新部署，这样内聚性和松耦合彻底丧失，微服务也将不复存在。







