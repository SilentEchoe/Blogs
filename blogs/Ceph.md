---
title: 分布式存储Ceph
date: 2024-9-2 10:23:00
tags: [存储,分布式]
category: 分布式
---

### 前言

存储一直是系统中最重要的部分，在云计算推动的当下，一方面平台需要用户创造的数字资产作为信息壁垒，另一方面平台也有责任和义务保全用户托管的信息。随着平台的用户数激增，对存储系统的要求也越来越高。

一个高扩展，高性能，高可用的分布式存储系统是系统稳定的重要基石，存储系统中大致可分为三部分：块存储，对象存储，文件存储。在主流的分布式存储中 HDFS 可以作为文件存储的代表；Swift 作为对象存储的代表；Ceph 同时提供了块，文件，对象三种存储方式，于是被称为统一存储。



### Ceph

分布式文件系统能聚合多个物理机上的存储空间并对外提供并行 I/O ，容错，水平扩展以及强一致性的数据存储系统。Ceph 是当前最流行的开源分布式存储系统，它的核心是可靠自主的分布式对象存储(Reliable Autonomic Distributed Object Store , RADOS) 通过该模块可以水平扩展大规模 OSDs 提供自愈，自管理并强一致性的副本对象存储服务。

RADOS 中的对象会被存储在逻辑分区(Pool); 对象会在池中分片，每个分片单位被称为放置组(Placement Groups PGs) 放置组中的数据会根据配置好的副本数同步到多个 OSD上，这样可以在单个 OSD 宕机时保证数据的正确性。

RADOS 集群中的每个节点都会为每个本地存储设备运行独立的 OSD 守护进程，这些进程会处理来自 librados 的请求并配合其他的 OSD 节点完成数据的拷贝，迁移以及错误恢复等操作，所有的数据都会通过内部的 ObjectStore 接口持久化到本地。

传统的分布式文件系统一般都会直接将本地的文件系统直接作为存储后端，以本地文件系统作为基础构建更加通用的文件系统服务，但 Zed 编辑器为例，只有在无法满足更加复杂的场景下，才会选择从最底层重新构建。如今的Ceph存储后端没有直接使用本地文件系统，而是直接管理本地的裸设备。这么做的原因有三点：

1.直接在本地文件系统上构建无额外开销的事务机制是非常复杂的

2.本地文件系统的元数据性能对分布式文件系统的性能有很严重的影响

3.成熟的文件系统有非常严格的接口，适配新的存储硬件很困难





事务实现

基于文件系统内部的事务机制





### 学习资料

[分布式存储 Ceph 的演进经验](https://draveness.me/papers-ceph/)

[基于k8s搭建Ceph分布式存储](https://www.tangyuecan.com/2020/02/17/%E5%9F%BA%E4%BA%8Ek8s%E6%90%AD%E5%BB%BAceph%E5%88%86%E9%83%A8%E7%BD%B2%E5%AD%98%E5%82%A8/)

