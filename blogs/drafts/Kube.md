StatefulSet 是用来管理有状态应用的工作负载 API 对象。

它和Deployment 类似，StatefulSet 管理基于相同容器规约的一组Pod。但是StatefulSet 会为每个Pod维护了一个“有粘性”的ID。这些Pod基于相同的规约来创建(相同的Pod模版)，但是不能互相替换：因为每个Pod都有一个永远不变的ID。

它的初衷是希望使用存储卷为工作负载提供持久存储，StatefulSet 可以作为解决方案的一部分。



数据存储类的应用往往会比较复杂，比如TiDB，作为一个分布式存储的数据库，它会存在多个实例，往往在本地磁盘上保存一份数据。如果按照无状态应用的标准来看待它们，当它们因为某种故障重启时，实例与数据之间的对应关系也会丢失。这对数据库来说是不可容忍的。



### StatefulSet

StatefulSet 在设计之初抽象了两种情况：

1.拓扑状态。某些场景下应用实例必须按照某些顺序启动，比如A必须比B先启动，它们代表着某种依赖关系，当你删除这两个Pod时，它们再次被创建出来时也必须按照这个顺序。

2.存储状态。应用的多个实例会绑定了不同的存储数据。对于Pod来说，它第一次读取的数据，应该和隔了十分钟之后再次读取到的数据应该是同一份(同一份数据源)，即使这个Pod被重新创建。



> StatefulSet 和核心功能就是通过某种方式记录这些状态，然后在Pod被重新创建时，能够为新的Pod恢复这些状态。



Persistent Volume Claim（PVC）和 Persistent Volume（PV）的 API 对象是为了降低了用户声明和使用持久化 Volume 的门槛。

